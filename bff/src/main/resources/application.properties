server.port=8081
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}

# OAuth2 Client Configuration
spring.security.oauth2.client.provider.keycloak.issuer-uri=${KEYCLOAK_ISSUER_URI:http://localhost:8080/realms/my-realm}
spring.security.oauth2.client.registration.keycloak.client-id=${KEYCLOAK_CLIENT_ID:bff-client}
# WARNING: Change this secret in production! Default matches pre-configured Keycloak realm.
spring.security.oauth2.client.registration.keycloak.client-secret=${KEYCLOAK_CLIENT_SECRET:mysecret}
spring.security.oauth2.client.registration.keycloak.authorization-grant-type=authorization_code
spring.security.oauth2.client.registration.keycloak.redirect-uri={baseUrl}/login/oauth2/code/keycloak
spring.security.oauth2.client.registration.keycloak.scope=openid,profile,email

# BFF Session JWT Configuration
# IMPORTANT: Generate your own RSA key pair for production!
# Use: openssl genpkey -algorithm RSA -out private_key.pem -pkeyopt rsa_keygen_bits:2048
bff.jwt.issuer=${BFF_JWT_ISSUER:https://bff.example.com}
bff.jwt.signing-key=${BFF_JWT_SIGNING_KEY:-----BEGIN PRIVATE KEY-----MIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQCt8TSGG5vZs9+QqLKfL+VUKEBfF2I8E5KZ0S4HjGUQftbKkTnD55bjkiL80aQ8fBAlCBxHVbkrkWXWnUqha5Y9zS7WE92UdgWTJ1jUi7Afe07rCeJNtFld3lNNAYcWNthoTVMRNgjk29UWR/cDUFisbVLxIPY/SbZ9XftgMGVxPEq/Ol3BnfA2RXaeRAlCprT1OJxCys+i7JQTc2nIbp1H4159u3z8C71d0qWhdaDh086LeeERDXzSavmVGmYJ6kYMoH9sr78ZffB0dQmlrOSYPL89myQaj9fI6UVFF1B83dp6vKXaiPDUOtDmsSpzSPCSkVTBs1YskyXoE7ZAfj/JAgMBAAECggEAB7pkfsPZwgullnAEVaHDYuCR8Zegn/IvrIFYdfHlKJ02DlRy+FMBB3Xd85Ud4qkRb4/Db+DtY/PnDii5YOAekfrchprl2JuAxme0YOce6VspZ7Rt901YvhyrX0u+1HwV09aBpw1bSk3BEycZ4K4QboLB8WApSKkOAFZtXXnw+92i5TxY29gWQdaM8YQ91mvTrusvvOqVxxIGPeIazZ96T2ZD9RAm0TiDvoiIgpLFsSMSb/0vVaKkM9NBFVgQQgHp34Qm9fLrcRjL4mc5IO7NpYDlvLpVzi0AI3DONoZnfjGO7V3qd/qHhks5WZiNyGkyvW/1lzjD4XiAZbykQZw+4QKBgQDTp8wJGDxv8nzySZJQjF0SLy86MEboMHyH+xWcf1u4MyOxcWcCsdOutAy4f8SeGgPdkFdN1FHUejz/AnpsiKiqkZ4uj97kEnmBJ0RpM7WidCy6aaKg83SSFiKTHXRaLkYsS2tkzn/0oh0SKjhrifcbUpijzV/YFshTRl9iGS7tGQKBgQDSYqWaFFFhf98LJlKEc5YNALwFo0S9Hz05Z2XO5FZQJ+44U/Pz0/taEnBmDkIkklV8FiM6Y2XXHuG9EHgM10rks6Yn+JZESalUZw0EOGJs6KWjDORxFZVosg5FXoKViveAj6Wr4O7DSIkrkxeKDYWxPCEhvUd140r0jDRiX9eOMQKBgHY9k1qxU3ImwW6Jc1fUUlpKSdP0DGjCTY+Z0WTwMUkiKJqEg8uZlGxQ4ZpgpnK8jdRFQsCUEHLnJxQ/Si0/2xoO55OThC1dtMtWKH2tCZeL10D8qoHIACNsgjw1hD6tAz7Tk1dplUoRFrSDKanKFWYKKoO3xAdwEtGSys5+yxxhAoGAEZUG6/KIvpI2LLNeMA2M27dU/0+evgNvVW3Lt1ej0v0TTofNmnH7zpI97HmCk5XbKQyckxOdfjXpfahzr/cKHkTZPPvsavaQ/SnDj7e6mglzVkYMjVrVarN+t9NnLGI5vvfCS7P3oEBenlKjo/jvVFmHF0+/Oh3ttLRG6HXECPECgYBH1UcL6mKP3AWIrUmGM/wFj4OXjwCoy9MZ6cwdDvOKcqEF8HrMSH5Ur/IXD1HSx+9bedZAcw/lNJ4jyVn37mFI+i65eg9S9WjT/ZTs6VaSm6Qb98zk4CNa8mLbRPzVfYykEURsQphVm2kDewLMAK+wnRSCGms58DXGgHnHHZ1sig==-----END PRIVATE KEY-----}

# Cookie Configuration
bff.cookie.name=BFF_SESSION
bff.cookie.secure=${BFF_COOKIE_SECURE:false}
bff.cookie.http-only=true
bff.cookie.same-site=Lax
bff.cookie.path=/

# Session TTL in minutes (aligned for JWT and Redis)
bff.session.ttl-minutes=30

# Downstream Gateway URL
bff.gateway.url=${GATEWAY_URL:http://127.0.0.1:8888}

# Frontend URL for post-login redirect
bff.frontend.url=${FRONTEND_URL:http://localhost:4200}

# CORS Configuration
bff.cors.allowed-origins=${CORS_ALLOWED_ORIGINS:http://localhost:4200}
bff.cors.max-age-seconds=3600

# Token refresh buffer (seconds before expiry to trigger proactive refresh)
bff.token.refresh-buffer-seconds=60

# Actuator
management.endpoints.web.exposure.include=health,info,metrics,prometheus

# Distributed Tracing
spring.application.name=bff
management.tracing.sampling.probability=${TRACING_SAMPLING_PROBABILITY:1.0}
management.zipkin.tracing.endpoint=${ZIPKIN_ENDPOINT:http://localhost:9411/api/v2/spans}

# Circuit Breaker Configuration (Resilience4j)
resilience4j.circuitbreaker.instances.gateway.slidingWindowSize=10
resilience4j.circuitbreaker.instances.gateway.failureRateThreshold=50
resilience4j.circuitbreaker.instances.gateway.waitDurationInOpenState=10s
resilience4j.circuitbreaker.instances.gateway.permittedNumberOfCallsInHalfOpenState=3
resilience4j.circuitbreaker.instances.gateway.automaticTransitionFromOpenToHalfOpenEnabled=true
resilience4j.circuitbreaker.instances.gateway.registerHealthIndicator=true

# Timeout for gateway calls
resilience4j.timelimiter.instances.gateway.timeoutDuration=10s
